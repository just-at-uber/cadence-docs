(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{413:function(e,t,r){"use strict";r.r(t);var a=r(8),i=Object(a.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"archival"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#archival"}},[e._v("#")]),e._v(" Archival")]),e._v(" "),r("p",[r("Term",{attrs:{term:"archival",show:"Archival"}}),e._v(" is a feature that automatically moves "),r("Term",{attrs:{term:"workflow"}}),e._v(" histories from persistence to another location after the retention period. The purpose of archival is to be able to keep histories as long as needed while not overwhelming the persistence store. There are two reasons you may want to keep the histories after the retention period has past:")],1),e._v(" "),r("ol",[r("li",[r("strong",[e._v("Compliance:")]),e._v(" For legal reasons histories may need to be stored for a long period of time.")]),e._v(" "),r("li",[r("strong",[e._v("Debugging:")]),e._v(" Old histories can still be accessed for debugging.")])]),e._v(" "),r("p",[r("Term",{attrs:{term:"archival",show:"Archival"}}),e._v(" is still in beta and there are three limits to its feature set:")],1),e._v(" "),r("ol",[r("li",[r("strong",[e._v("Only Histories:")]),e._v(" Only histories are archived, visibility records are simply deleted after the retention period.")]),e._v(" "),r("li",[r("strong",[e._v("RunID Required:")]),e._v(" In order to access an archived history, both workflowID and runID are required.")]),e._v(" "),r("li",[r("strong",[e._v("Best Effort:")]),e._v(" There are cases in which a history can be deleted from persistence without being archived first. These cases are rare but are possible with the current state of "),r("Term",{attrs:{term:"archival"}}),e._v(".")],1)]),e._v(" "),r("p",[e._v("Work is being prioritized on "),r("Term",{attrs:{term:"archival"}}),e._v(" to eliminate these limitations.")],1),e._v(" "),r("h2",{attrs:{id:"concepts"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#concepts"}},[e._v("#")]),e._v(" Concepts")]),e._v(" "),r("ul",[r("li",[r("strong",[e._v("Archiver:")]),e._v(" Archiver is the component responsible for archiving and retrieving "),r("Term",{attrs:{term:"workflow"}}),e._v(" histories.  Its interface is quite generic and supports different kinds of "),r("Term",{attrs:{term:"archival"}}),e._v(" locations: local file system, S3, Kafka, etc. Check "),r("a",{attrs:{href:"https://github.com/uber/cadence/blob/master/common/archiver/README.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("this README"),r("OutboundLink")],1),e._v(" for how to add a new archiver implementation.")],1),e._v(" "),r("li",[r("strong",[e._v("URI:")]),e._v(" An URI is used to specify the "),r("Term",{attrs:{term:"archival"}}),e._v(" location. Based on the scheme part of an URI, the corresponding archiver will be selected by the system to perform "),r("Term",{attrs:{term:"archival"}}),e._v(".")],1)]),e._v(" "),r("h2",{attrs:{id:"configuring-archival"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#configuring-archival"}},[e._v("#")]),e._v(" Configuring Archival")]),e._v(" "),r("p",[r("Term",{attrs:{term:"archival",show:"Archival"}}),e._v(" is controlled by both "),r("Term",{attrs:{term:"domain"}}),e._v(" level config and cluster level config.")],1),e._v(" "),r("h3",{attrs:{id:"cluster-archival-config"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#cluster-archival-config"}},[e._v("#")]),e._v(" Cluster Archival Config")]),e._v(" "),r("p",[e._v("A Cadence cluster can be in one of three "),r("Term",{attrs:{term:"archival"}}),e._v(" states:")],1),e._v(" "),r("ul",[r("li",[r("strong",[e._v("Disabled:")]),e._v(" No "),r("Term",{attrs:{term:"archival",show:"archivals"}}),e._v(" will occur and the archivers will be not initialized on startup.")],1),e._v(" "),r("li",[r("strong",[e._v("Paused:")]),e._v(" This state is not yet implemented. Currently setting cluster to paused is the same as setting it to disabled.")]),e._v(" "),r("li",[r("strong",[e._v("Enabled:")]),e._v(" "),r("Term",{attrs:{term:"archival",show:"Archivals"}}),e._v(" will occur.")],1)]),e._v(" "),r("p",[e._v("Enabling the cluster for "),r("Term",{attrs:{term:"archival"}}),e._v(" simply means histories are being archived. There is another config which controls whether histories can be accessed from "),r("Term",{attrs:{term:"archival"}}),e._v(". Both these configs have defaults defined in static yaml, and have dynamic config overwrites. Note, however, dynamic config will take effect only when "),r("Term",{attrs:{term:"archival"}}),e._v(" is enabled in static yaml.")],1),e._v(" "),r("h3",{attrs:{id:"domain-archival-config"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#domain-archival-config"}},[e._v("#")]),e._v(" Domain Archival Config")]),e._v(" "),r("p",[e._v("A "),r("Term",{attrs:{term:"domain"}}),e._v(" includes two pieces of "),r("Term",{attrs:{term:"archival"}}),e._v(" related config:")],1),e._v(" "),r("ul",[r("li",[r("strong",[e._v("Status:")]),e._v(" Either enabled or disabled. If a "),r("Term",{attrs:{term:"domain"}}),e._v(" is in the disabled state no "),r("Term",{attrs:{term:"archival",show:"archivals"}}),e._v(" will occur for that "),r("Term",{attrs:{term:"domain"}}),e._v(".\nA "),r("Term",{attrs:{term:"domain"}}),e._v(" can safely switch between statuses.")],1),e._v(" "),r("li",[r("strong",[e._v("URI:")]),e._v(" The scheme and location where histories will be archived to. When a "),r("Term",{attrs:{term:"domain"}}),e._v(" enables "),r("Term",{attrs:{term:"archival"}}),e._v(" for the first time URI is set and can never be mutated. If URI is not specified when first enabling a "),r("Term",{attrs:{term:"domain"}}),e._v(" for "),r("Term",{attrs:{term:"archival"}}),e._v(", a default URI from static config will be used.")],1)]),e._v(" "),r("h2",{attrs:{id:"running-locally"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#running-locally"}},[e._v("#")]),e._v(" Running Locally")]),e._v(" "),r("p",[e._v("In order to run locally do the following:")]),e._v(" "),r("ol",[r("li",[r("code",[e._v("./cadence-server start")])]),e._v(" "),r("li",[r("code",[e._v("./cadence --do samples-domain domain register --gd false --history_archival_status enabled --retention 0")])]),e._v(" "),r("li",[e._v("Run the "),r("a",{attrs:{href:"https://github.com/uber-common/cadence-samples",target:"_blank",rel:"noopener noreferrer"}},[e._v("helloworld cadence-sample"),r("OutboundLink")],1),e._v(" by following the README")]),e._v(" "),r("li",[e._v("Copy the workflowID and runID of the completed "),r("Term",{attrs:{term:"workflow"}}),e._v(" from log output")],1),e._v(" "),r("li",[r("code",[e._v("./cadence --do samples-domain wf show --wid <workflowID> --rid <runID>")])])]),e._v(" "),r("p",[e._v("In step 2, we registered a new "),r("Term",{attrs:{term:"domain"}}),e._v(" and enabled history "),r("Term",{attrs:{term:"archival"}}),e._v(" feature for that "),r("Term",{attrs:{term:"domain"}}),e._v(". Since we didn't provide an "),r("Term",{attrs:{term:"archival"}}),e._v(" URI when registering the new "),r("Term",{attrs:{term:"domain"}}),e._v(", the default URI specified in "),r("code",[e._v("config/development.yaml")]),e._v(" is used. The default URI is "),r("code",[e._v("file:///tmp/cadence_archival/development")]),e._v(", so you can find the archived "),r("Term",{attrs:{term:"workflow"}}),e._v(" history under the "),r("code",[e._v("/tmp/cadence_archival/development")]),e._v(" directory.")],1),e._v(" "),r("h2",{attrs:{id:"faq"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#faq"}},[e._v("#")]),e._v(" FAQ")]),e._v(" "),r("h3",{attrs:{id:"how-does-archival-interact-with-global-domains"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#how-does-archival-interact-with-global-domains"}},[e._v("#")]),e._v(" How does archival interact with global domains?")]),e._v(" "),r("p",[e._v("When "),r("Term",{attrs:{term:"archival"}}),e._v(" occurs it will first run on the active side and some time later it will run on the standby side as well.\nBefore uploading history a check is done to see if it has already been uploaded, if so it is not re-uploaded.")],1),e._v(" "),r("h3",{attrs:{id:"can-i-specify-multiple-archival-uris"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#can-i-specify-multiple-archival-uris"}},[e._v("#")]),e._v(" Can I specify multiple archival URIs?")]),e._v(" "),r("p",[e._v("No, each "),r("Term",{attrs:{term:"domain"}}),e._v(" can only have one URI for history "),r("Term",{attrs:{term:"archival"}}),e._v(" and one URI for visibility "),r("Term",{attrs:{term:"archival"}}),e._v(". Different "),r("Term",{attrs:{term:"domain",show:"domains"}}),e._v(", however, can have different URIs (with different schemes).")],1),e._v(" "),r("h3",{attrs:{id:"how-does-archival-work-with-pii"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#how-does-archival-work-with-pii"}},[e._v("#")]),e._v(" How does archival work with PII?")]),e._v(" "),r("p",[e._v("No cadence "),r("Term",{attrs:{term:"workflow"}}),e._v(" should ever operate on clear text PII. Cadence can be thought\nof as a database and just as one would not store PII in a database PII should not be\nstored in Cadence. This is even more important when "),r("Term",{attrs:{term:"archival"}}),e._v(" is enabled because\nthese histories can be kept forever.")],1),e._v(" "),r("h2",{attrs:{id:"planned-future-work"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#planned-future-work"}},[e._v("#")]),e._v(" Planned Future Work")]),e._v(" "),r("ul",[r("li",[e._v("Support "),r("Term",{attrs:{term:"archival"}}),e._v(" of visibility.")],1),e._v(" "),r("li",[e._v("Support accessing histories without providing runID.")]),e._v(" "),r("li",[e._v("Provide hard guarantee that no history is deleted from persistence before being archived if "),r("Term",{attrs:{term:"archival"}}),e._v(" is enabled.")],1),e._v(" "),r("li",[e._v("Implement paused state. In this state no "),r("Term",{attrs:{term:"archival",show:"archivals"}}),e._v(" will occur but histories also will not be deleted from persistence.\nOnce enabled again from paused state, all skipped "),r("Term",{attrs:{term:"archival",show:"archivals"}}),e._v(" will occur.")],1)])])}),[],!1,null,null,null);t.default=i.exports}}]);